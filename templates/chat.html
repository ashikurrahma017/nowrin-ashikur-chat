{% extends "base.html" %}
{% block title %}Chat | WhatsChat{% endblock %}

{% block content %}
<div class="whatsapp-layout {% if active_username %}chat-view{% else %}list-view{% endif %}"
     data-current="{{ current_username }}"
     data-active="{{ active_username or '' }}">

    <!-- LEFT SIDEBAR: USER LIST + SEARCH -->
    <aside class="sidebar">
        <header class="sidebar-header">
            <div class="profile-circle">{{ current_username[0]|upper }}</div>
            <span class="sidebar-username">{{ current_username }}</span>
            <a class="logout-link" href="{{ url_for('logout') }}">Logout</a>
        </header>

        <div class="sidebar-search">
            <input id="user-search" type="text"
                   placeholder="Search username">
        </div>

        <div class="chat-list" id="user-list">
            {% for u in users %}
            <div class="chat-list-item {% if active_username == u.username %}active{% endif %}">
                <a class="chat-list-link" href="{{ url_for('chat', username=u.username) }}">
                    <div class="chat-avatar">{{ u.username[0]|upper }}</div>
                    <div class="chat-info">
                        <div class="chat-title username-text">{{ u.username }}</div>
                        <div class="chat-last">{{ u.last_msg }}</div>
                    </div>
                </a>
            </div>
            {% endfor %}
            {% if users|length == 0 %}
            <div class="chat-last" style="padding:0.8rem;">
                No other users yet. Ask others to register and they‚Äôll appear here.
            </div>
            {% endif %}
        </div>
    </aside>

    <!-- MAIN CHAT AREA -->
    <main class="chat-main">
        <header class="chat-header">
            <!-- mobile back button -->
            <div class="mobile-back" onclick="window.location.href='{{ url_for('chat') }}'">
                ‚Üê
            </div>

            <div class="chat-header-info">
                {% if active_username %}
                    <div class="chat-avatar">{{ active_username[0]|upper }}</div>
                    <div>
                        <div class="chat-title">{{ active_username }}</div>
                        <div class="chat-subtitle">Personal chat</div>
                    </div>
                {% else %}
                    <div>
                        <div class="chat-title">Select a person</div>
                        <div class="chat-subtitle">
                            Choose a username from the list to start chatting
                        </div>
                    </div>
                {% endif %}
            </div>
        </header>

        <section class="chat-body" id="messages">
            {% if not active_username %}
            <div class="empty-state">
                <p>Select a user on the left to see your messages with them.</p>
            </div>
            {% endif %}
        </section>

        <footer class="chat-footer">
            <form id="message-form">
                <div class="input-icons">
                    <label for="image-input" class="icon-button" title="Send photo">üìé</label>
                    <input id="image-input" type="file" accept="image/*" style="display:none">
                </div>
                <div class="input-wrapper">
                    <input id="message-input" type="text"
                           placeholder="{% if active_username %}Type a message{% else %}Select a user first{% endif %}"
                           autocomplete="off"
                           {% if not active_username %}disabled{% endif %}>
                </div>
                <button type="submit" class="send-button"
                        {% if not active_username %}disabled{% endif %}>‚û§</button>
            </form>
        </footer>
    </main>
</div>

<script src="{{ url_for('static', filename='script.js') }}"></script>
{% endblock %}
