<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nowrin & Ashikur</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #0f2027;  /* fallback */
      background: linear-gradient(to right, #2c5364, #203a43, #0f2027);
      color: white;
      overflow-x: hidden;
    }

    /* Animated Hearts */
    body::before {
      content: "💖 💕 💘 💝 💓 💗 💞 💌";
      position: absolute;
      top: -100px;
      left: 0;
      width: 100%;
      font-size: 3rem;
      text-align: center;
      animation: hearts 10s linear infinite;
      opacity: 0.3;
    }

    @keyframes hearts {
      0% { transform: translateY(0); }
      100% { transform: translateY(120vh); }
    }

    #login, #chat {
      display: none;
      padding: 60px 20px;
      text-align: center;
    }

    #login {
      display: block;
    }

    input, button {
      padding: 12px;
      margin: 10px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      outline: none;
    }

    input {
      width: 80%;
      max-width: 300px;
    }

    button {
      background-color: #ff5f6d;
      color: white;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background-color: #ffc371;
      color: black;
    }

    #chat-box {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      height: 400px;
      overflow-y: scroll;
      max-width: 700px;
      margin: auto;
    }

    .message {
      margin: 10px 0;
      padding: 10px 15px;
      border-radius: 20px;
      max-width: 75%;
      display: inline-block;
      clear: both;
    }

    .me {
      background-color: #dcf8c6;
      color: black;
      float: right;
    }

    .other {
      background-color: #eee;
      color: black;
      float: left;
    }

    #footer {
      text-align: center;
      font-size: 14px;
      color: #ccc;
      margin-top: 30px;
    }

    @media (max-width: 600px) {
      #chat-box {
        height: 300px;
      }
      input {
        width: 90%;
      }
    }

    #typewriter {
      font-size: 20px;
      margin-bottom: 30px;
      font-style: italic;
      height: 30px;
    }
  </style>
</head>
<body>

<div id="login">
  <h2 id="typewriter"></h2>
  <input id="username" placeholder="Username"><br>
  <input id="password" type="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
  <p id="login-msg" style="color: pink;"></p>
</div>

<div id="chat">
  <h3 id="welcome"></h3>
  <div id="chat-box"></div>
  <div style="margin-top:20px;">
    <input id="msg" placeholder="Type a message">
    <button onclick="sendMsg()">Send</button>
  </div>
</div>

<div id="footer">
  <p>Only for Nowrin Noor — Powered by Ashikur Arefin</p>
  <p>All rights reserved by Ashikur Arefin © 2025</p>
</div>

<script>
  const socket = io();
  let currentUser = "";

  function login() {
    const u = document.getElementById("username").value.trim();
    const p = document.getElementById("password").value.trim();
    fetch("/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username: u, password: p })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        currentUser = u;
        document.getElementById("login").style.display = "none";
        document.getElementById("chat").style.display = "block";
        document.getElementById("welcome").textContent = "Welcome, " + u;

        data.history.forEach(displayMessage);
      } else {
        document.getElementById("login-msg").innerText = "Invalid login.";
      }
    });
  }

  function sendMsg() {
    const msg = document.getElementById("msg").value.trim();
    if (msg) {
      socket.emit("message", { user: currentUser, msg });
      document.getElementById("msg").value = "";
    }
  }

  function displayMessage(data) {
    const div = document.createElement("div");
    div.className = "message " + (data.user === currentUser ? "me" : "other");
    div.textContent = `${data.user} (${data.time}): ${data.msg}`;
    document.getElementById("chat-box").appendChild(div);
    document.getElementById("chat-box").scrollTop = document.getElementById("chat-box").scrollHeight;
  }

  socket.on("message", displayMessage);

  // Typewriter romantic lines
  const lines = [
    "I'm still waiting for your message, Nowrin...",
    "Every beep could be your hello 💬",
    "My day starts with your text and ends with your thoughts 💭",
    "No message feels complete unless it’s from you 💌",
    "I refresh this screen just to see your words ✨",
    "The silence feels loud without your text 🔕",
    "One text from you, and my whole world lights up 💡",
    "This chatbox belongs to our love story 💖",
    "No one types like you... my Nowrin Noor 👑",
    "Ashikur is waiting patiently — just say 'Hi' 💞"
  ];
  let i = 0, char = 0;

  function typeWriter() {
    if (char < lines[i].length) {
      document.getElementById("typewriter").innerHTML = lines[i].substring(0, char + 1);
      char++;
      setTimeout(typeWriter, 80);
    } else {
      setTimeout(() => {
        char = 0;
        i = (i + 1) % lines.length;
        typeWriter();
      }, 2000);
    }
  }

  window.onload = typeWriter;
</script>

</body>
</html>
